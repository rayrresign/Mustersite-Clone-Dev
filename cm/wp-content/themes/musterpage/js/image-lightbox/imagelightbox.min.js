/*
 By Osvaldas Valutis, www.osvaldas.info
 Available for use under the MIT License
 */

!function(a,b,c,d){"use strict";var e=function(){var a=c.body||c.documentElement,a=a.style;return""==a.WebkitTransition?"-webkit-":""==a.MozTransition?"-moz-":""==a.OTransition?"-o-":""==a.transition&&""},f=e()!==!1,g=function(a,b,c){var d={},f=e();d[f+"transform"]="translateX("+b+")",d[f+"transition"]=f+"transform "+c+"s linear",a.css(d)},h="ontouchstart"in b,j=(b.navigator.pointerEnabled||b.navigator.msPointerEnabled,function(a){if(!h)return!1;if("undefined"!=typeof a.MSPOINTER_TYPE_MOUSE){if(a.MSPOINTER_TYPE_MOUSE!=a.pointerType)return!0}else if("mouse"!=a.pointerType)return!0;return!1});a.fn.imageLightbox=function(d){var d=a.extend({selector:'id="imagelightbox"',allowedTypes:"png|jpg|jpeg|gif",animationSpeed:250,preloadNext:!0,enableKeyboard:!0,quitOnEnd:!1,quitOnImgClick:!1,quitOnDocClick:!0,onStart:!1,onEnd:!1,onLoadStart:!1,onLoadEnd:!1},d),e=a([]),h=a(),i=a(),k=0,l=0,m=0,n=!1,o=function(b){return"a"==a(b).prop("tagName").toLowerCase()&&new RegExp(".("+d.allowedTypes+")$","i").test(a(b).attr("href"))},p=function(){if(!i.length)return!0;var c=.8*a(b).width(),d=.9*a(b).height(),e=new Image;e.src=i.attr("src"),e.onload=function(){if(k=e.width,l=e.height,k>c||l>d){var f=k/l>c/d?k/c:l/d;k/=f,l/=f}i.css({width:k+"px",height:l+"px",top:(a(b).height()-l)/2+"px",left:(a(b).width()-k)/2+"px"})}},q=function(b){if(n)return!1;if(b="undefined"!=typeof b&&("left"==b?1:-1),i.length){if(b!==!1&&(e.length<2||d.quitOnEnd===!0&&(b===-1&&0==e.index(h)||1===b&&e.index(h)==e.length-1)))return s(),!1;var c={opacity:0};f?g(i,100*b-m+"px",d.animationSpeed/1e3):c.left=parseInt(i.css("left"))+100*b+"px",i.animate(c,d.animationSpeed,function(){r()}),m=0}n=!0,d.onLoadStart!==!1&&d.onLoadStart(),setTimeout(function(){i=a("<img "+d.selector+" />").attr("src",h.attr("href")).load(function(){i.appendTo("body"),p();var c={opacity:1};if(i.css("opacity",0),f)g(i,-100*b+"px",0),setTimeout(function(){g(i,"0px",d.animationSpeed/1e3)},50);else{var j=parseInt(i.css("left"));c.left=j+"px",i.css("left",j-100*b+"px")}if(i.animate(c,d.animationSpeed,function(){n=!1,d.onLoadEnd!==!1&&d.onLoadEnd()}),d.preloadNext){var k=e.eq(e.index(h)+1);k.length||(k=e.eq(0)),a("<img />").attr("src",k.attr("href")).load()}}).error(function(){d.onLoadEnd!==!1&&d.onLoadEnd()});var c=0,l=0,o=0;i.on("pointerup MSPointerUp click",function(a){if(a.preventDefault(),d.quitOnImgClick)return s(),!1;if(j(a.originalEvent))return!0;var b=(a.pageX||a.originalEvent.pageX)-a.target.offsetLeft;h=e.eq(e.index(h)-(k/2>b?1:-1)),h.length||(h=e.eq(k/2>b?e.length:0)),q(k/2>b?"left":"right")}).on("touchstart pointerdown MSPointerDown",function(a){return!(j(a.originalEvent)&&!d.quitOnImgClick)||(f&&(o=parseInt(i.css("left"))),void(c=a.originalEvent.pageX||a.originalEvent.touches[0].pageX))}).on("touchmove pointermove MSPointerMove",function(a){return!(j(a.originalEvent)&&!d.quitOnImgClick)||(a.preventDefault(),l=a.originalEvent.pageX||a.originalEvent.touches[0].pageX,m=c-l,void(f?g(i,-m+"px",0):i.css("left",o-m+"px")))}).on("touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",function(a){return!(j(a.originalEvent)&&!d.quitOnImgClick)||void(Math.abs(m)>50?(h=e.eq(e.index(h)-(m<0?1:-1)),h.length||(h=e.eq(m<0?e.length:0)),q(m>0?"right":"left")):f?g(i,"0px",d.animationSpeed/1e3):i.animate({left:o+"px"},d.animationSpeed/2))})},d.animationSpeed+100)},r=function(){return!!i.length&&(i.remove(),void(i=a()))},s=function(){return!!i.length&&void i.animate({opacity:0},d.animationSpeed,function(){r(),n=!1,d.onEnd!==!1&&d.onEnd()})};return a(b).on("resize",p),d.quitOnDocClick&&a(c).on("click",function(b){i.length&&!a(b.target).is(i)&&s()}),d.enableKeyboard&&a(c).on("keyup",function(a){return!i.length||(a.preventDefault(),27==a.keyCode&&s(),void(37!=a.keyCode&&39!=a.keyCode||(h=e.eq(e.index(h)-(37==a.keyCode?1:-1)),h.length||(h=e.eq(37==a.keyCode?e.length:0)),q(37==a.keyCode?"left":"right"))))}),a(c).on("click",this.selector,function(b){return!o(this)||(b.preventDefault(),!n&&(n=!1,d.onStart!==!1&&d.onStart(),h=a(this),void q()))}),this.each(function(){return!o(this)||void(e=e.add(a(this)))}),this.switchImageLightbox=function(a){var b=e.eq(a);if(b.length){var c=e.index(h);h=b,q(a<c?"left":"right")}return this},this.quitImageLightbox=function(){return s(),this},this}}(jQuery,window,document);